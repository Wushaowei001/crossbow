# Copyright (c) 2013 Radek Micek

OCAMLFLAGS += -thread

OCAML_LIB_FLAGS += \
    -ccopt -L../minisat -cclib -lminisat \
    -ccopt -L../cmsat -cclib -lcmsat \
    -ccopt -L../bliss -cclib -lbliss

OCAMLPACKS[] =
    threads
    batteries
    tptp
    zarith
    oclock
    cmdliner

if $(defined coverage)
    OCAMLPACKS[] += bisect
    OCAMLFLAGS += -syntax camlp4o
    export OCAMLPACKS
    export OCAMLFLAGS

FILES[] =
    earray
    elist
    algo
    equiv
    timer
    sh
    symb
    term
    lit
    clause
    clause2
    prob
    term_def
    splitting
    tptp_prob
    sorts
    assignment
    sinterp
    sat_solver
    minisat
    cmsat
    csp_solver
    bliss
    symred
    lnh
    ms_model
    model
    sat_inst
    minisat_inst
    cmsat_inst

libcrossbow.cmxa libcrossbow$(EXT_LIB): \
    ../minisat/libminisat$(EXT_LIB) \
    ../cmsat/libcmsat$(EXT_LIB) \
    ../bliss/libbliss$(EXT_LIB)

OCamlLibrary(libcrossbow, $(FILES))

section
    SOURCES = $(filter-exists $(addsuffixes .ml .mli, $(FILES)))
    CMI_FILES = $(addsuffix .cmi, $(removesuffix $(SOURCES)))

    doc: doc/index.html

    doc/index.html: $(SOURCES) $(CMI_FILES) /.PHONY/OCamlGeneratedFilesTarget
        mkdir -p doc
        ocamlfind ocamldoc \
            -thread -d doc -html -stars -sort \
            $(PREFIXED_OCAMLINCLUDES) \
            $(mapprefix -package, $(OCAMLPACKS)) \
            $(SOURCES)

OCAML_LINK_FLAGS += -cc g++

OCAML_LIBS[] =
    libcrossbow

OCamlProgram(crossbow, main)

program: crossbow$(EXE)

clean:
    $(CLEAN)
    rm -rf crossbow$(EXE)
    rm -rf doc
